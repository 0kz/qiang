# -*- coding: UTF-8 -*-
import requests

from meituan_logger import logger
from coupons_timer import CouponsTimer
from jdUA import jdUA as ua
from config import global_config
from concurrent.futures import ProcessPoolExecutor
from util import (
    parse_json,
    wait_some_time
)


class Meituan(object):
    def __init__(self):
        self.coupons_timer = CouponsTimer()

    # 随机ua
    def ua_random():
        sys.path.append(os.path.abspath('.'))
        global ua
        for n in range(3):
            try:

                break
            except:
                url = 'https://ghproxy.com/https://raw.githubusercontent.com/wuye999/myScripts/main/jd/jdUA.py'
                response = requests.get(url)
                with open('jdUA.py', "w+", encoding="utf-8") as f:
                    f.write(response.text)

    def make_coupons(self):
        global local_time, str, resp_json, i
        """美团"""
        meituan = 'https://cube.meituan.com/topcube/api/toc/playWay/sendCoupon?k=84843'
        payload = {
            'callback': 'fetchJSON',
            # 'sku': self.sku_id,
            # '_': str(int(time.time() * 1000)),
        }
        headers = {
            'User-Agent': 'Mozilla/5.0 (iPhone; CPU iPhone OS 14_7_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 TitansX/20.0.1.old KNB/1.0 iOS/14.7.1 meituangroup/com.meituan.imeituan/11.12.405 meituangroup/11.12.405 App/10110/11.12.405 iPhone/iPhoneXR WKWebView',
            "Content-Type": 'application/x-www-form-urlencoded',
            'Host': 'cube.meituan.com',
            'Referer': 'https://mop.meituan.com/awp/hfe/block/35daf4df68c6/84843/index.html?shark=1&activityId=6&src=group_start_pic&linglongScene=%E6%94%BE%E8%82%86%E5%90%83%E5%96%9D&uuid=000000000000025C2125F5C034EA693AD4F1F90EE3C83A155914936627232000&version_name=11.12.405&utm_term=11.12.405&utm_source=AppStore&utm_content=000000000000025C2125F5C034EA693AD4F1F90EE3C83A155914936627232000&userid=297782217&utm_medium=iphone&lat=39.921832&utm_campaign=AgroupBgroupD200H0&token=7X2QO0HJs9ZqfZNKZ75hmjIBvGsAAAAATQ4AAL3wwqnn5UamIKp7ZFgMT2F8zBdGcSI_Juyr0AQyBIGHFyXnnlxcBiIVjERryneEDA&language=zh-CN&regionid=&lng=116.475296&f=iphone&ci=1&msid=9A12EAA8-DADD-4049-8D4E-88279ED799871630047511212912',
            # 'cookie': '__jdu=16208764115771539430091; areaId=1; ipLoc-djd=1-3065-0-0; shshshfpa=73f33e1e-79c9-fa5f-a2e4-ad8d23722843-1620876412; shshshfpb=qPe52husztho0W2g8nVE2jA%3D%3D; unpl=V2_ZzNtbUZeRxwiCRUAfhkPDWIGRw9LB0UcJgpCB3JJCAM0VhdcclRCFnUUR1BnGVoUZwYZWEtcRxNFCEdkexhdBWYHE1xEVXMXfA5HUnIpbAZnMxNtQlBAFHwOQVF7GVgDYQMWX0pSQRR0AEZkSxlUAlczIl1LX0MQcAlDV3MpXARnAhptQ2cIe3RFRlN4GFUDYAYSXUZRRRVxCk5ReRhdDWczE21B; __jdv=122270672|kong|t_1001050073_387078|jingfen|5858f0be41b944dc8a78b35b8ae7bd40|1621234138504; __jdc=76161171; retina=1; cid=9; webp=1; mba_muid=16208764115771539430091; visitkey=18760757834574002; jcap_dvzw_fp=lhemSFuzpHX8pcrFLvnxQfr0h3dXbasdh4le2QKDKk5Sbu3zKwBuB1RydWCpgMho8OAKUA==; whwswswws=; PPRD_P=UUID.16208764115771539430091; sc_width=1440; 3AB9D23F7A4B3C9B=BZ4GZNB46MAEGBEXXGBOFRWMO4WU2NWC6NNWIUD3A7IU3MXYYDB5ISYR33R2BRSC4P2LY3EE4QO7DYXUXCXFZ7V4FY; __jda=76161171.16208764115771539430091.1620876412.1621433070.1621480007.5; TrackerID=T_5xR-fJiW-GexJNpbDejHrPTqZ4t6QBhFpycREg04WFTxKRyc4P1PX-ygSxdzDf0cW6HSuExxl11YwrMDrjvUzeRr2US3wdX8Qkl6TkamIFXNJO5VaNkRNQ1UqOCb0Q; pt_key=AAJgpdKfADCDO1sqROnutA1Ax_dvo75JQBsK5o8_ZOol2S4BhHBAM4EYNjlKUOhmrXBfIJwyB0o; pt_pin=jd_58c7396bf1d5c; pt_token=3u8ttfet; pwdt_id=jd_58c7396bf1d5c; sfstoken=tk01mde2c1d18a8sMXgyKzIrMSszh+tyu3l4k8EZ8dsNYvH8U5tP2wSNIjjz1VctKBMqVzCLWJ2WdXQNjrrr+yqxS5BC; RT="z=1&dm=jd.com&si=jtri2jl7eht&ss=kowbc24b&sl=1&tt=0&nu=d41d8cd98f00b204e9800998ecf8427e&cl=1qr5&obo=1&ld=1s4h&r=0b28ea838121668d9fe0076f8ba4b475&ul=1s4k&hd=1t0a"; __wga=1621480099364.1621480099364.1621433070268.1621419292139.1.3; shshshfp=51cf1daf073dd46f3a51cb59d480c95e',
            'cookie': '_lxsdk_cuid=17a425b8e06c8-0a0938b9457e01-34647600-13c680-17a425b8e06c8; unpl=v1_ikrjJyKoarlq159nDVkD0OVaT_kxGdyM5R8rBvNPwu4NyeFHzlUya4QptSIEfb-_; _ga=GA1.2.2031100322.1627986515; IJSESSIONID=node01pbmi4oesvmzn178j6daglcmqk10931517; iuuid=8122E0C31D7EFB166EC4113E04010352F31AB52AC7174E6A5A03F6B909F25D89; ci=1; cityname=%E5%8C%97%E4%BA%AC; _lxsdk=8122E0C31D7EFB166EC4113E04010352F31AB52AC7174E6A5A03F6B909F25D89; __utmc=74597006; ci3=1; meishi_ci=1; cityid=1; _hc.v=b372a487-c507-ed72-ef60-00f6fe7cc211.1629425949; wm_order_channel=mtib; utm_source=60030; au_trace_key_net=default; openh5_uuid=8122E0C31D7EFB166EC4113E04010352F31AB52AC7174E6A5A03F6B909F25D89; __utma=74597006.2031100322.1627986515.1629425927.1630142040.2; __utmz=74597006.1630142040.2.2.utmcsr=google|utmccn=(organic)|utmcmd=organic|utmctr=(not%20provided); backurl=http://i.meituan.com/account/?cevent=imt%2Fft%2Forder; uuid=1cd1c036d5e641518dd3.1630142053.1.0.0; a2h=1; cssVersion=83d2813d; request_source=openh5; channelType={%22mtib%22:%220%22}; channelConfig={%22channel%22:%22default%22%2C%22type%22:0%2C%22fixedReservation%22:{%22reservationTimeStatus%22:0%2C%22startReservationTime%22:0%2C%22endReservationTime%22:0}}; latlng=40.005727,116.564669,1630142063284; i_extend=Gimthomepagecategory122H__a100001__b2; token=evkocTUlatz8y6MTb3Or0ertNDQAAAAAbg4AAIbdWsT2KkMUSGPofdhs6cU9xiyTPTitxsB5JZEEiUOS3-eQvQ98akeheWqRju4NNg; mt_c_token=evkocTUlatz8y6MTb3Or0ertNDQAAAAAbg4AAIbdWsT2KkMUSGPofdhs6cU9xiyTPTitxsB5JZEEiUOS3-eQvQ98akeheWqRju4NNg; oops=evkocTUlatz8y6MTb3Or0ertNDQAAAAAbg4AAIbdWsT2KkMUSGPofdhs6cU9xiyTPTitxsB5JZEEiUOS3-eQvQ98akeheWqRju4NNg; userId=297782217; u=297782217; isid=evkocTUlatz8y6MTb3Or0ertNDQAAAAAbg4AAIbdWsT2KkMUSGPofdhs6cU9xiyTPTitxsB5JZEEiUOS3-eQvQ98akeheWqRju4NNg; _lx_utm=utm_term%3D11.12.405%26utm_source%3DAppStore%26utm_content%3D000000000000025C2125F5C034EA693AD4F1F90EE3C83A155914936627232000%26utm_medium%3Diphone%26utm_campaign%3DAgroupBgroupD200H0; _lxsdk_s=17b8c39bc58-bd1-215-88a%7C%7C142'
        }

        strrr1 = {"positionCityId": 1, "uuid": "1cd1c036d5e641518dd3.1630142053.1.0.0", "visitCityId": 1,
                  "playWaySecrets": "2674241ab5", "sourceType": "MEI_TUAN", "userId": "297782217",
                  "voucherSourceType": "OUTER_APP", "requestTime": self.coupons_timer.local_time(),
                  "nonceRandom": "c5546115-a4c6-351c-38d8-990b3797d3e3",
                  "mini_program_token": "evkocTUlatz8y6MTb3Or0ertNDQAAAAAbg4AAIbdWsT2KkMUSGPofdhs6cU9xiyTPTitxsB5JZEEiUOS3-eQvQ98akeheWqRju4NNg",
                  "requestSign": "cGxheVdheVNpZ24sTVRZek1EWXpOVFF5TnpVd01peGxZVEpoWWpaaFppMDNNV1kxTFdZelpEUXROV05sTlMxbU5tWm1aVGN3TnpnNFpXUT0=",
                  "cubeActivityUrl": "https://mop.meituan.com/awp/hfe/block/35daf4df68c6/84843/index.html?shark=1&activityId=6&src=group_start_pic&linglongScene=%E6%83%85%E4%BE%A3%E7%BA%A6%E4%BC%9A&uuid=000000000000025C2125F5C034EA693AD4F1F90EE3C83A155914936627232000&version_name=11.12.405&utm_term=11.12.405&utm_source=AppStore&utm_content=000000000000025C2125F5C034EA693AD4F1F90EE3C83A155914936627232000&userid=297782217&utm_medium=iphone&lat=40.045968&utm_campaign=AgroupBgroupD200H0&token=7X2QO0HJs9ZqfZNKZ75hmjIBvGsAAAAATQ4AAL3wwqnn5UamIKp7ZFgMT2F8zBdGcSI_Juyr0AQyBIGHFyXnnlxcBiIVjERryneEDA&language=zh-CN&regionid=&lng=116.460565&f=iphone&ci=1&msid=9A12EAA8-DADD-4049-8D4E-88279ED799871630141995916754&userId=297782217&token=evkocTUlatz8y6MTb3Or0ertNDQAAAAAbg4AAIbdWsT2KkMUSGPofdhs6cU9xiyTPTitxsB5JZEEiUOS3-eQvQ98akeheWqRju4NNg",
                  "RiskForm": "eyJ1dWlkIjoiMWNkMWMwMzZkNWU2NDE1MThkZDMuMTYzMDE0MjA1My4xLjAuMCIsInRvdWNoUG9pbnQiOiI2ODYuMDcwMzEyNSw3MjUuNTE1NjI1IiwiY2FtcGFpZ25QbGF0Zm9ybSI6MywicGFydG5lciI6MiwiY3ViZUNhbXBhaWduSWQiOjg0ODQzLCJtYWdpY0N1YmVDYW1wYWlnbmlkIjoiMjY3NDI0MWFiNSIsImlzVmlzaXRlZFBhZ2UiOjAsImxvY2F0aW9uIjoiNDAuMDA1NzI3XzExNi41NjQ2NjkiLCJwbGF0Zm9ybSI6MywiaDVGaW5nZXJwcmludCI6ImVKeWxWM212bzBpUy95cldrNm8wSTdzZmh6bTc5YlRpQmh1TXpXRmpqMGF0TkNTSE9jMXBzOXJ2dnVsWFZkMXY5dC8xUVVZRVFaTHhpeU16L3Z0dGhPM2I3Mi9FTy9xK3JkNWFJMEljL3NCeHhQVGQyKzhFczhhWk5jMFFQTTRRcTdmd1AyVnJqbCs5WGR1ai9QYjd2emdjWHhFa1JmMzdKWEdRNEY4VWtqQWsrZS9WMzlRYVI3K1hob0VVM3RLK2I3cmZNYXlzbS9jU1p2MEFxdmV3TGpFd05WZ2FRK3hhMUdHT3Jla0l4RlFVTTF6SVlCekZVV3NzcXlMNGVFLzdzdml2TGdWdC9rRjhCMkdmalZuL05LSVA1bnZYaGg5Sld3L05uMTBQMnY3UEpndS9GMW1WRkhXVnVDR3M0TWMzaGZuR3JiOXg5RGVGK2lZcTM0VDFONFg5SmdyZkJPWlRJbjNqaGUvRGtFVWYrTmNQU1Vza1FkSXFMZUZyU2hFWWZpM0lsRXFvUEs0b2E0bGJDd1JOOHdURnJ4bUdaTWsxaVI3NWpoRHVzcnI2c3dJbC9DQVF6dVE3aGRQZmg3NzhzNGR0K1g5RVhUMjBJZndRbXNidDZ4Wit5c0s2Nm1IVi8vK1hNblN3UlNhUlBNdHlKRW13bjdPWE1NcUc4aU5yMHJxQzN3dlFmMUQ0TzA3UlBNUDllRHNvRzVBbDFZZndDYW40ZVpYUmZEcit2YTl6V0gyd0FYbXdjWDNUOFpkN2ZObHRMeXlkbGpkREhMVk9lSDI4QXlVSTVucWE3bFZGKzZBMHRnMTdVUlBMSTFWdUZpTXRkSTAvTjhPenhZWERVelEwWFgwR1ZWVThRakV6ampmRmFaOFZWR1FCTGExS0JwREFqem45VGRwOWIyR0NZRVhtZkMrcUJLSEl2Rk1NVGpQMDkvaVhMV0dHQXFQc2tBb3ZFS1FpQ054dnNpREx2MUU0eGYvR3laVHlHOGVSTEsvSUxNOXo3Q3VzQ1lyZ2VRUWJ3OUxVSjFyR1Y3UitXQXZIdkE0OUh3RTFjMC9HOHE1cnU4VmgyKy9rdzZlMTF3UlphMXlqVStlUjI5enlYVzFmeDFIYU1hSFBQN0tudC9leS90R0o5T2FpS0psdnUrdmY0R0U4OEJ6SVlRcFBkK2MyVUx0ZGd2THZEU1ZLNmIwU2hlSFlGVXN5S0hmWWx6Qi9DZEVJL3VPbWJCeVJBdmRTNkg4cFdDaWIwVXhaMVF5dnpIM0pya1BmMTlVdnBxMzNQNmpHUlM1RzJuRHpORytKTHdpT0x3eUhqdy8wZEpncjZNWVRkb2lPLzFKNzdIeThIOGxac0xDc2wrYjVRYVEwR1RtMGxmVE9YcmttY2ZmSU02czkzayt5Mm16cGNjMVlBRHVLVkI1dnowYTJwNDJ4OU9MYXRRTlI1RzdudWgxak1Gd08vYlRrbW16djBVRHhuK0lUUGpNbHYzSlpQYXJibWJKbWVUbG92WndEcWJnSit5cENhTWxZMklmdWFTa1ZSK09vQnJSZFdrWmlCbXFwN3RoOGRwZ2tkM3ZjblppZzlaV0l3dWltVjVzQzZLMmFkTVlWZ3VraDJseE1xKzdwc1RmTVV5SzNvcDd5NnZiaytHVHQyL1ZWaVdYc1NpOU5zMWd6V3pXenMydmttM1BKNDBXSFMzdXVheWt5ckM5am8xTFZVb2h5TFNHSW1taVpjbFE2Mlp6R0xaY3d5K1B5ZHVTRE0wNGQrd0xaTWFZUlEwOEU0M25Ua29DQ2RDZjlZQnhtMmM5WWY5czUyaUExaGpacXRDbWY5YWQxOXJYSDVGeUd0RTM1RUlEbHd3L3FOQVZHdFNkdXBWU0M5VkVYd21CdlBTVXBZdTRWZzhXdVRZWWEzRkI4M0kvYlc0OTdwWVZOeHV6WVludlVXdHpaSE1qZDloWmNnejZyRDVzTnlYcEtVazZGVDhmYm9mUTg1ZlRzaVROTEdtTVdEMm1nU2FubnA5UE5KT1RBUHhGaHlHMlhTdjhJdmNEc2QvRlI3K3h1WTRaWG5KU1BjU01WT2IxN0ZsM0JGdWFWbEhxWXMrUnlkcGFKVWdvWFFKWWRXVzZ2VmV0c1p0dGtOOWNJN3BacUt1dk8weXFuSTNZdUp3ZjIwMkdqdzVvdTNHRUljb1pQRHpLYlczT1dWU1U3bDAvMWJLaVp4dDNuNktrYzdoZkJ2aWZTUmhtU2t6VlBKUjFmWThPS3lsa0gwSW5LRXo1clliUlVqWTBhcG8rUllqZHJSdHFmckpGM3hQcEE5WW96U2VhZHovWGRnYnFWVnFSYlhldkVXdlBVeldNQkN0N2VyQU5PTDhtVzI5ckxydlRTRTMzY3dxWStWTXZ0cHROSFZzRWtIeCt4U1RoTVdzQ2c5SWdxbEhsdlE1Vlg5VlM5VXVlSTJBajA0UGVzUkpVTGE2cmtqeXZvSUVPdHNxTm9PeE8rMVpMNlZUVjJycDhxZm9Jb2tYcnhVQkxPcjVHMXRrejJXVmVDbmV2Z2h0QjJWTWk4S3MzdzJEaUs2cnZLUUJERjBqZ2VmZitCNmZzaWZmU0ZjSE9ZTTdmSFFoWGZHSUVDOHhJRXRTc2R0a2Fncng4YnQ3V3dNZmNQaHpJelprSnpEUHdpRW9hVkhPcmNPUlFlb3pSTnpxdmltVTVGcXhCOFZjMVR1U3B1YTNiWWhZKzF6VjJXREcrMjZUVGZpTFpkOGhBeUdFOCt1eWJMemJPSjlSUnd4ckhuR1VDaUxOSHRPTFM0dFc2WWdUQ2dyVDJjNEhoZUR3RVhCQS92cVM1bEY2ZjNCSFVtb3d1NXB4UWRKcDdlN2FPcGMzS2FCT2xreUVNODBRU2ZvRHFETTVlRXJMcVF2NFVuWHREcytvS2w2V3hxOGZhaHE5Wm0xTTk2NWM2dDJPUFFvU0Z2ZGdld3A5ekttbU4rZldjVTB6YXloak01M1Z4dTVIZ3p5US96dXR3THU3QllUajFwa0JWK3dFUHJUQ2RXU21YdDNEOTNJMVl5RW5ZcnFXc1M1c2IrWEp6ay9Ybks5ZzZ4M0MzRlM3eHg0ek5XRFE5bk9Zc0s3RFFURHRMNmtXVmIyNkVjR1U1YVQ5L28rQmI2TTQ1Y1dXb0tHSVdZMDNWdTNwd3UxNFRGbWpQVGJBaGpQcWZuSXJwSTdGVHI5RTVNa2oycHFOZFRJc1ZsR0J6TzFobkptTjFaWjNLeEltNFM0MkZ6bmt4QVZ3enZpYnp2NE9DQzZiUVdYbzRzSnM5TGh0VW90NytkcExJeER3WTRaL2ZhSm9KOFBxNzlUZEFGekliaDVLWFFidHJON1h5NlAzcVhHL0RqTFQ2a1hUY2MvVEZpTDZhQmJ4OE5OUVgwcVpsMncvWk9NWGRXZlJ5enFQRzZXZWsxa2JVMG16eEo0ejZuajdkUU1JN0ZJUjZteWFadnpNNmFzRFF6enVtMTNaL3ZFbmR3bkVCU2JuRjZ2U1pYQVRBUHVSS3AyQmdpZTNmZ2w3eWtMeDhOMU5MQXVkU2llV05USUZTVUZSNW1tNTY0MjIxTDVQd2piYXRTVEhOOW1MVkszSFVpZkFyalZSdktqUTlIcjZRR280cnBZajJqOWFHMUNMV2NoVklYaE9wMUNPMXE3NEppR1ZTSC9mM1VZTXZwREl0ZVVwUkdJMVR1ZUJsVXJONEhEcCsydEF1ZmsrbFNLSS93Q1BEeFpXMmNHQWUzNHd2KzZPM0xtbW9Dc2JueFFUdmRteU0vOHp4MG1lMG80by9kT2MzVzU1dDBtZ01qaURtWEpkMWxwV3ZtMkxoejJPdTZHUkNtRksvVGdxZ2ROblRkKzVZeERmZ1kxMmRmdGpkZ1E4dTJ2QXp3VWJVcmhvaTFLK09UNDNyYkhBSmIzS2VZWkxPcW9IcmRYY1EveTREckgyMW5TMHRudzNodHp0T3J3cHpnZFp2MUw4NzVpMXVnUVRPUmJCQ1F6S3JuckNnQVJyL2ppMytZR1FyWlB4WkNGYlYxRmkyWWQveVB4UTQraG01Qkw4UWhLeUxNY2dTYTIvMXpnWTZoQmZ3eEgwYXYyZmMxcy9qSFZ2Y3NjN1Vvc2h3dU5Cam05VDhYVXRyV0pVUTE0QjEvcDJpQ2ZpZG9mbUhWMTZ5QUN4ZkVvTTErUG8yVzAzV29SS0pXb3ZnMTF0S1BRMHIzMThsQzlhM0JMbWZCeHk3UnBSUEdNMmxmbk16M21kbDNMMmh6UEZpUGFyZEowQTVTcFZRcGFGNnEwN3dMVHFURHR1NCtpQjd6Y3JlNUNYNlhvaFBCQllDdVpmWnVxYkVVZmN0MjdEQnBoVmpOUkFxWU1ONWNhZHFwUWdPZGNMazY5ZXhMdGUxNGFNaFRWUXRLY1N2clltMnYzWjE1UERvQmJ4L3ZPeERCaG9saE5kT2xnNHNuWENIdzJxejZFNzEwamxiUVRXWTM0QTR2WGVudXlDMTlkYTdETm05b1hVL1lEbTFhQ2R0V0htdUdvNmlvUFh0ODZGRll4dU5VWFlsbHE1N3Y1SU0xVUZ3SHNYUEwxWXN6WVVxTk9YU2RxOHg0Yk04Q2ZtV09nOUVwWjk0VHk0eWV0bGRjT2FPRGpQdlVCQ2U5SnduYXIwMmg4KzVNTlRGMGI0bU93SmVaT3UrYko2dkNVT3U4Qk50dWQvaHlubzc5eFhCN3ZhVTF6WHFJUWRRWXJjMFZvMVhRK2NES3pXR0h1Zk15bWU3akRiSVJENW04Y2NnY0dOd2p3YUI4dVhseEpESFQrVVpoeFM0LzFsVEdOMG9aVTlWMVdVbWVVOHdvdFZ6V21NZzVKbVp0YiswSjNydWJneFUrUEY2RjRKNGNVbGJVU3dWNldiSnZGVzBmbjZYbHpoSFZMVWR1YUxReGsxMVliekIrdU91anlEQm1mT3BDNHZTSVhXazZjTzVCdnBGYlRYaVdHeXpJdFB0NVBJKzcxbkQ2eTNHK1ZKaDRaZS8reFR2b0dHTmVaWHZwNXBpNURoa211ZDVidmlqTWJFTXZCV3dyVDg3NWxUK3hpV0lPWlFKQW9XclZWYjBTMmd3VVA2NExzUUJoL3BQVzRiV0YwMDltQjlxMi9zVTQ5WUQ2MFdoaGVRdXhMcUtmVXIvS3dqcENrN29ycVM2ekVDVkMxZjNnaGphRDdhOFJaZDYwMGxCUE9nSTAxRzJTZ1pVT2l4SDJXZmlGUW1vRFhCbW9GUXY3bGVsTGhpd3NORWZZeWNyS3lzSzI3dXE0Ly9FS0YvVjQ4UXJaQXNKNnRRZW9UOG1RV1I1STZ4S3N2S3lFM1kvcjY4Vm83U1dvVmw0TFVhVk1ZZjlhM3hHMkVhakE2b1FhNWdqOXU3K3BCZm1GWHErRUVHVkQrVndvVmRLQ0VTRmdLdDVLS05IN1ExQXR2R2NEcHpaRFBlN3FzNHlnS2dHcUVMYlBYMnhkMU8xQ0tldGI5bFBpeWd1dDdsT0UxUTRpUnh5Vm5lR3NoT2ZRcCtBSlZpSnEvd3J3c2pFQjVjTGFJVUdYdzNaRWRRMnV4Q3haU0tCRERmNUtyQ1BVRmk1WThtOXFZUmRSMXo5ZmVuK0ozQklVUlFpYWJpVzJJQ3JnYzZHREtrTE0wS1VMTjJ5ekJxSGhyZENpaS94YWd6YjZRaTVjNVFjWERWMy82Y293elNvME5BMXNVWHZSdzVXY1JYVy9Vb1ltaFdVR0ZyNGt1Q3QxNklmMjVXVTRnOFcrclZjYVd2dW4wMWJhY0FNdDh0UVg4N1NoTFljOHpWNjBEclBYUGVrbjRTRWlhMEdDSEx2WWduejRCUnVhYy9mM0hTdXJ3clQrS2F4aFhLQmc4K0NqWDIxQlZvQU9vTEdxUVBRVjBtMDdWRW1md21abG9jQjVvbi81NWE2RkNqa0NHQTBJOTRXSzl0SFZxeDdDY3JXcmV6alZiWjgrVi9iZU15eGhaYmZaOCt2TXRpdHNCUlNPelJNQmpNYTJmMzZHeXg1MTlUMDZHbGNvK0tRVXRxakZoaXVuRHZNSkZzWEtCV1A5aEorS2JsWWh4TDlPNmVZb1Zkd0s2ZjFJd2ZUbFB3K1VXZkZGeVlQRmtBeGZCV2xkWFZIbXJTNmdpUkZNYi8venY1MEVMVUE9In0",
                  "cubeActivityId": 84843}

        strrr2 = {"playWaySecrets": "e7947a8cd8", "sourceType": "MEI_TUAN", "userId": "297782217",
                  "requestTime": self.coupons_timer.local_time(), "nonceRandom": "ce440547-06a3-e0b2-b600-c47d17a6adee",
                  "requestSign": "cGxheVdheVNpZ24sTVRZek1EWTFNek0wTXpBM09DeGpaVFEwTURVME55MHdObUV6TFdVd1lqSXRZall3TUMxak5EZGtNVGRoTm1Ga1pXVT0",
                  "cubeActivityUrl": "https://mop.meituan.com/awp/hfe/block/35daf4df68c6/84843/index.html?shark=1&activityId=6&src=group_start_pic&linglongScene=%E6%83%85%E4%BE%A3%E7%BA%A6%E4%BC%9A&uuid=000000000000025C2125F5C034EA693AD4F1F90EE3C83A155914936627232000&version_name=11.12.405&utm_term=11.12.405&utm_source=AppStore&utm_content=000000000000025C2125F5C034EA693AD4F1F90EE3C83A155914936627232000&userid=297782217&utm_medium=iphone&lat=40.045968&utm_campaign=AgroupBgroupD200H0&token=7X2QO0HJs9ZqfZNKZ75hmjIBvGsAAAAATQ4AAL3wwqnn5UamIKp7ZFgMT2F8zBdGcSI_Juyr0AQyBIGHFyXnnlxcBiIVjERryneEDA&language=zh-CN&regionid=&lng=116.460565&f=iphone&ci=1&msid=9A12EAA8-DADD-4049-8D4E-88279ED799871630141995916754&userId=297782217&token=evkocTUlatz8y6MTb3Or0ertNDQAAAAAbg4AAIbdWsT2KkMUSGPofdhs6cU9xiyTPTitxsB5JZEEiUOS3-eQvQ98akeheWqRju4NNg",
                  "cubeActivityId": 84843}

        strrr = "positionCityId=1&uuid=1cd1c036d5e641518dd3.1630142053.1.0.0&visitCityId=1&playWaySecrets=2674241ab5&userId=297782217&sourceType=MEI_TUAN&weixinCode=&voucherSourceType=OUTER_APP&requestTime=1630653343078&nonceRandom=9802f948-f040-ee9f-cfb7-54dfd12fd1b6&requestSign=cGxheVdheVNpZ24sTVRZek1EWTFNek0wTXpBM09DdzVPREF5WmprME9DMW1NRFF3TFdWbE9XWXRZMlppTnkwMU5HUm1aREV5Wm1ReFlqWT0%3D&mini_program_token=evkocTUlatz8y6MTb3Or0ertNDQAAAAAbg4AAIbdWsT2KkMUSGPofdhs6cU9xiyTPTitxsB5JZEEiUOS3-eQvQ98akeheWqRju4NNg&cubeActivityUrl=https%3A%2F%2Fmop.meituan.com%2Fawp%2Fhfe%2Fblock%2F35daf4df68c6%2F84843%2Findex.html%3Fshark%3D1%26activityId%3D6%26src%3Dgroup_start_pic%26linglongScene%3D%25E6%2583%2585%25E4%25BE%25A3%25E7%25BA%25A6%25E4%25BC%259A%26uuid%3D000000000000025C2125F5C034EA693AD4F1F90EE3C83A155914936627232000%26version_name%3D11.12.405%26utm_term%3D11.12.405%26utm_source%3DAppStore%26utm_content%3D000000000000025C2125F5C034EA693AD4F1F90EE3C83A155914936627232000%26userid%3D297782217%26utm_medium%3Diphone%26lat%3D40.045968%26utm_campaign%3DAgroupBgroupD200H0%26token%3D7X2QO0HJs9ZqfZNKZ75hmjIBvGsAAAAATQ4AAL3wwqnn5UamIKp7ZFgMT2F8zBdGcSI_Juyr0AQyBIGHFyXnnlxcBiIVjERryneEDA%26language%3Dzh-CN%26regionid%3D%26lng%3D116.460565%26f%3Diphone%26ci%3D1%26msid%3D9A12EAA8-DADD-4049-8D4E-88279ED799871630141995916754%26userId%3D297782217%26token%3DevkocTUlatz8y6MTb3Or0ertNDQAAAAAbg4AAIbdWsT2KkMUSGPofdhs6cU9xiyTPTitxsB5JZEEiUOS3-eQvQ98akeheWqRju4NNg&cubeActivityId=84843&RiskForm=eyJ1dWlkIjoiMWNkMWMwMzZkNWU2NDE1MThkZDMuMTYzMDE0MjA1My4xLjAuMCIsInRvdWNoUG9pbnQiOiI5MjQuNzMyNzI3MDUwNzgxMiwxMDM2LjY0NjcyODUxNTYyNSIsImNhbXBhaWduUGxhdGZvcm0iOjMsInBhcnRuZXIiOjIsImN1YmVDYW1wYWlnbklkIjo4NDg0MywibWFnaWNDdWJlQ2FtcGFpZ25pZCI6IjI2NzQyNDFhYjUiLCJpc1Zpc2l0ZWRQYWdlIjowLCJsb2NhdGlvbiI6IjQwLjAwNTcyN18xMTYuNTY0NjY5IiwicGxhdGZvcm0iOjMsImg1RmluZ2VycHJpbnQiOiJlSnlsVjJlUHEweVcvaXV0bHJvMUkrNXRjbnBIclJVNW0yUXc5bWgwQlpnY1RUYXIvZTlMOTUxM2RuYS9Ma1krZ1VOUjU2azZvZjd6ZFVtRzF6OWU0WS9qOS9yamRWRHVod1J0RUhRSTAvajZCMHlnRUlHaktJWlNNUGJqTmY3Zk9ockRmN3hHZzgrLy92RjNHRWJ3SHdpR0V2LzRVam1INXU4b2lmK2dZT1FmUC82SFE3RGovckpRRG9QWGZKcjY4UThRYkxyK28wbUthUTdiajdocndIRHR3VHhOd0tqdTRncEU4WHVZWXZlVW9HSUNwREFLUThHaXZTZmJSejQxOVgrTWVUaFVuL0I3R0UvRlVreFA1ZjVKdkk5RC9Ka04zZHovR3Fkd21INzFSZnhlRjIxV2QyM214a21iZkw0SnhCdUZ2bEg0bTRDOXNjSWJnNzRKNUJ2THZESEV0NFo3bzVuM2VTN3VuOUMvWHdqT0lZZWpJczVCS0NZd0JJMHlQQ2JDSWcwSkFzcFJLQVBqT0Exak5Fb1FDSW1neVBISyt3SHhXSFR0cnpac2trLzRBQnI1d0NEOGZaNmFYMU15TlA5SE5YYnpFQ2VmVE4rN1V6Y2szN3E0YTZla25mNy9VNW5IWkRoY1FtaVNwQkFFSnI5SGI1SjdNVGVmUlo5M2JmSmVoOU1uQm4xQUdFNFQxTyt2aDAwZkZsbjd5WHhEeW43Lzg4ZDRNdlErZFZYU2ZwSUJZcHVRckk3MDdaSGVUdHFOeFBPbVZOaEZHcG12NjJ4akRLT2o2L3BvVzl3TEcwWHJ5WnVZR1dkRXBIYjJMc1d1OGt1ZG53UEUyRTlXa1dUeEdiUnR2Y1Zzb2ZpbDRBelBOaEY0NXBoYW04MWhsbnp1K1UvdTlENGsyUUhyNGM1NzNXWUhpc1FIUmtBNGdiK25mL29TRjhmR2FNYkRoR1pnUkdBWTZpZlA4UHhQRE1Mb254U1BDVDhwQ2lGcGdTZHBtaUsvOWpXTXdUUjl3RWFRT1BhTmx2THZhUDMyTmxtcUxqNTdCMUE3OVNTTWM0U2FBNVFNMDRtM3Y3Mk5zc05iSmJwZnhqT2lWWWJuU2xhWDN2T1JpRDE2SzU1bjYxeE0yOGppNmswUUNzOTAwWitKdmRnMEZWWkpubHdlVGpsanAxTjJCT0RyRVNqTitRaVVnMWIvcE9FLzZmU25iQndCZTlnV2JUOS9CZWVYTHBxbnFXdi9GSWJPK3MzMTdyR0loM1dpUHZVeTh4akc4WmpaL3Z3ODNvNHI0WGp3VE1hRFQvOWx0cDA4YUZxUW5USEFZdUwyZllOekhMazd1SkZOamlWRVdUcHVWV0VNL3VQQ2k3MkdMeWhoaEtEUFlsV3FYWlhDd3BXbE9hZWRhd1lzUzVYWGJsalNjTDdaMHdwUWZXR2Q4VkR3bnV3emVSWkNGVkZGdDRqYWpoazdEOHpTeEZjaFY1ZU0xZDRQUEhnd25tTDNBbkMxci9oaWdKdU5vV1I2SURiaWlheDJoOGdxZDRMY2xRZ0dUN2hqSU41UFlsK0g4aUJtb3hJbDRicXhKcFhpb252WkxFVy9aUHpBeWprdGFoZkhRenJQN0NJaDVjRUlCM1M5UmdsTkxNd2l1bnY2M3RCUVBVS2NSWTBEaHNUZGJlbEZyQVdZZXlWbE1OekJBOUVzd3NqcjY2SlJHUUg0UU9uVHdSWEMvS2srL0ZqeU80R3ZNSEUrcndDY01Od0Q4WUpsM25tdklEMXRkS1NaNnhWcGtYQ2R2OHBQNCtwSjIrcmM1bnpJNlRnTWdjMEx1andQbGRhQ3k0WnJRdFNYbVRpd2pDZkgzWWxIUzRDcGF5S3hsS2dZblU2TFZrN1F1VEhBVmRrZGt4MThhWUFjMVVaT1dobEV3VlIwdHFvaTVGbkltclgyOEZTYm0vTlp1RHduK0VvaXlsS2tjeDVJWEg3MjhyWFVZVDd3TG5BY1V4b2dURnQ4RHZUcGxQcnlhSTZxSGtjUXd2dHB6OVVWZm5yV1kwM1dlb1J3VTFLUkNMQTdRQ1kwekMxRW1oRnB0S2dkSEhVM2RWS043c2tKRUhOZWRwNUdzL3JndFZtZFpGcHRWVTQ2dkhibk9hZ0lPcmQ1c2pMMm9tZ2JjbStlNGxVUkM0bDY3UGVuWUQ5dWpQbklPRldZczR1eHJ3MmVScWxpM0p0ZERoUG4zbHlnWFlydmdLaW9ZcHh2QzBhcUtNRlpGMk9oSGJhenNVbHdWazUvMEpWOHNyR3lNZTZ5TVE1T0t2VlBXZmZyc0taTkZRMG91VUVHU2pPQnNUbm5GOXpYa3I2elcwQlRSM2toQlpEem9BVmNHWHVWQXVJSWozdDdSTjdyM0ZadHQ3WmZvZU1mNGoyY3dqK0s1c2hOWU45bWY0dkNNU0d3SDRYUG1zNEthVkxXZmVXRmsrdmxncGNkSEl0OXlRbkhYTDhvYVdoRThaMDVncFByUUFvempGaE1mT1dTZVZNZFFmUmNZWWJoR2xCODMvTTJVTGJxZkp0cXBuU0lLMldCc1FpcFNpQWtWUk1HbmN2Wm1oTEk2S2E2Z3dFdWxXZmJUYUhzc09RbzBJMkZGU096dThxeDZ6TWg5SDFGaSt3VnoxbWpaanhSckhLK3JVdVVuRS94aHByVURTQm9mY2pYdllTSEFhQ1RoQUJwNURuMlJhVmZkWERDUW1kWkpwb0lrU05LWkRPTkRRcVZGVDFnNXFONHgydXlYTkU1b0lKZ096OUZnSGNoM0lLeEszSy9JUllteUVsMmxrZnJ2bzVPaFNOaHZpcjhuSzQ0VEdkSG5vR0lXNGEwWTB5WDhZVm1KTE83Z1htKzYxS3FiYkpvcUl0OGxWdDNIOWdKU2h3OG9mWFJEaTNNYlkwOXBkRUhJZWltVXZTVVRzazZvUEtwdXZLYkhnRVdjNHByWUowUUJXa2hHNHFOSzU0Wk9WWU0rL1E4TFdCRGNHRFpZRkVXVjRwMXJTKzhkVjBMeTRHQkU4RGVVdFZOcjJBN2J3NndzMEl5U25veWMraFdGSnJwWUE2ZnJOS0VsM2hheHQ0T0hVdlpTRUs0TUNrbHk5U3VYbTVSUm9MOWxlaFZXTm12K2JXKzN6aHk3V1Q4eEdhWmhRaGlkTW00dElrRCsycGNEeDF4dXNwRXhiWnd5UkZuY0sreU5aUUY1Znc4VnQrQndoc280MUo4ODBtUTN3R0NsREIzS2k5YzArdTJFbDZMUjJmQ1FiWDdxS2NHWTBDb0JNVUR6S0FPYW5tOVBMYkpwV2JJTDFNN0g4Zlo5NVk3ZWRNVlNOdDZiQTN3UzcrZVp1MkJFUTlTM1B6aTNwL0hYWmdrbGpRa0U3bHdpMVhoZmhremlsL2I2Ynl1Smw0U0oyTUY4MEs1NXRGZ1hSOGNaVHRPd0FsbG1rZFJGakVoc2ZFdGk2WEtmRGRQTmczUW5BeHNmU0xsZ1hQcldMMGs4NUJwTVNPMmR4TmZxYkxVNElyZThxRnQyTHlTNTExcTJkUElKazltaWFTNVViMWtPVGZZckxRcFhxUDdNYjlqTGt6SEZ6RTNCckVZemJIWldtNVlBMEZyVzQ5TER3THJOYWtuVGhCNkNSWXAvemFMWUdjRkRwMFB1SnM4VjkzRmpqaUM3aUdkM2xEbFFqaVFtZDZnYlRKdktOWUhiRi9Td2JBK2VwL2VhVHB4Q1cxaG9lMTB6UXYwV25LWFBWQ0NsSEpKeEFWYVdkS1gzdDNqU1piMUFOYTVGTTFydUhQSTJIVWZHcUVyeWJhZ1Y0ODMxVkRGZVpNSEFtZ1J6WmFBVXlraVBHUkJ0ZDRPVE5iS1FjNGtSVVk4anc4VytrNERydWViam9aelYwWDVLczZyLzd2RXI4NXZPak1ITmJxOXFPc1F4RCtnbDc4VTFsZTc4N2NYenZKZWZ2TXZwdnNDbzcrUVgraExYVlRKaXhIR1g2cmdyeTlIWTFrbmx5VFNpZ2s4MnFXdnhoOS8rWXNtbnczOXgyOWJLWW1yN3E4di91KzJGWVRSRCtnRGZURzZxS2dURU1ZRkdLTmUzREFOaCtJWUFQcytONHpqa1JUaEg2LzFuN1RqZnM5MS9GY3ZJVmJpYkRVN1krY3BxRnNMZDdrcUp1NG5TajVqNG5RWmhXWlQ3RTdmNUt1TmNuaWo4T290b0duRTZ5ZG5IOXlRZDBNS2gvR3JiN0FhRVFubk1HL04wZ0Y2M3diVHlZTDlKZExGN3JCcFNQV21MZTNSd0MzdXhPbk9vSWFuSjVMVW1CdE00elNpcmpjYlFlREVRVFpxdElkY1poU1VMczFFR0M0dUEwNzlQTTE3VmZxUU5XMlA1NlVNY1hNNHAvZk8wZU9ueGNSU2hpMytUUHVCbUlmYnBjSFVWdGw5QUs0bElxVkJyYXFUY3ZmMVJibmgwTEhGaUZJREx5VnMyRWNxS2FNbm50M3BDWTlxbkdmdkZReWNMNDZwNDhkQ3JWZFZidVZiTXBGNnFXb2xXZWhDTGtHTXhXdXNPK28zUkQ2QjdCcU5heDhSK0VJMVNXQlpFY1BDWmhaTmxXRmtpOFZCYllkemhWL1IreFVNalJNOU1QRGFYbGd2UWVVK3RTTGdZZkxNalFyb3A4dVVsbXUzRDFteW9UTW5TUlBhandGd3F2UzBhYkg3SkhUT0JWNXV2Q2lYZzJhY05xRzdObnhRWDlnVHRwblBzSDJZTllsTUFhcnBGNkIvb21ZRk1Dc0pHTUk2aDZHWG5NRlRHQmFzQTBicW9FelEwMjdpK3FoU0o0dkplSnlrdEZNV0UxR3ZUV0VqWE1NYkRETHh0bnNHS1pWblZicFJXeW55L1FoTkk5TWdvekhqUnowZzhxNWhCNzIrZDBYZ1JvMXVnaHk0bmoxaXpCb1pSQUc3N0wzam1OQWNCNXNjRld6VU9acHlDNlR5S1hwU2l2cjZYLzhORSthN3NnPT0ifQ%3D%3D"
        # logger.info(json.loads(str))

        # j = json.dumps(json.loads(strrr))

        while True:
            self.coupons_timer.start()

            while True:
                try:
                    i = 0
                    resp = requests.post(url=meituan, headers=headers, data=strrr)
                    resp_json = parse_json(resp.text)
                    logger.info(resp_json)

                except Exception as e:
                    logger.info(e)
                if str(resp_json).find('频繁') != -1:
                    i = i + 1
                    if i > 100:
                        return True

    def coupons(self, work_count=5):
        print('coupons!')
        with ProcessPoolExecutor(work_count) as pool:
            for i in range(work_count):
                pool.submit(self._coupons)

    def _coupons(self):
        """
        抢券
        """
        while True:
            try:
                self.make_coupons()
                break
            except Exception as e:
                logger.info('抢券异常!', e)
            wait_some_time()
